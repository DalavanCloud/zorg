{% import "utils.html" as utils %}

{% macro v4_run_page(ts, machine, run, compare_to, neighboring_runs,
                     comparison_neighboring_runs=none) %}

<center>
  <table>
    <tr>
      <td align=right>Machine:</td>
      <td>{{machine.name}}:{{machine.id}}</td>
    </tr>
    <tr>
      <td align=right>Run:</td>
{# FIXME: Don't hard code field name. #}
      <td>{{run.start_time}} ({{
        run.order.llvm_project_revision}})</td>
    </tr>
{% if compare_to %}
    <tr>
      <td align=right>Compare To:</td>
{# FIXME: Don't hard code field name. #}
      <td>{{compare_to.start_time}} ({{
        compare_to.order.llvm_project_revision}})</td>
    </tr>
{% endif %}
  </table>
</center>
<p>

<table width="100%%" border=1>
  <tr>
    <td valign="top" width="200">
      <h4>Machine:</h4>
      <a href="{{ v4_url_for('v4_machine', id=machine.id) }}">{{
        machine.name}}:{{machine.id}}</a>
      <h4>Runs:</h4>
      <ul>

{# Show a small number of neighboring runs. #}
{% for r in neighboring_runs %}
        <li>{{ "<h3>"|safe if r.id == run.id else "" }}
            <a href="{{v4_url_for('v4_run', id=r.id)}}">{{
                     r.start_time}}</a>{{
            "</h3>"|safe if r.id == run.id else ""}}
{% endfor %}
      </ul>

{# Show a small number of runs in the neighborhood of the comparison run. #}
{% if comparison_neighboring_runs %}
      <h4>Compare To:</h4>
      <ul>
{% for r in comparison_neighboring_runs %}
        <li>{{ "<h3>"|safe if r.id == compare_to.id else "" }}
            <a href="{{v4_url_for('v4_run', id=run.id, compare_to=r.id)}}">{{
                     r.start_time}}</a>{{
            "</h3>"|safe if r.id == compare_to.id else ""}}
{% endfor %}
      </ul>
{% endif %}
    </td>
    <td valign="top">
      <table border=1>
      <tr>
        <td> <b>Nickname</b> </td>
        <td> {{machine.name}} </td>
      </tr>
      <tr>
        <td> <b>Machine ID</b> </td>
        <td> {{machine.id}} </td>
      </tr>
      </table>
{{ utils.render_popup_begin('machine_info', 'Machine Info', true) }}
      <h4>Fields</h4>
      <table border=1>
{% for item in machine.fields %}
      <tr>
        <td> <b>{{item.name}}</b> </td>
        <td>{{machine.get_field(item)}}</td>
      </tr>
{% endfor %}
      </table>
      <h4>Parameters</h4>
      <table border=1>
{% for key,value in machine.parameters|dictsort %}
      <tr>
        <td> <b>{{key}}</b> </td>
        <td>{{value}}</td>
      </tr>
{% endfor %}
      </table>
{{ utils.render_popup_end() }}

{{ utils.render_popup_begin('run_info', 'Run Info', true) }}
      <h4>Fields</h4>
      <table border=1>
      <thead>
        <tr><th>Name</th><th>Value</th></tr>
      </thead>
{% for item in run.fields %}
      <tr>
        <td> <b>{{item.name}}</b> </td>
        <td>{{run.get_field(item)}}</td>
      </tr>
{% endfor %}
      </table>

      <h4>Parameters</h4>
      <table border=1>
      <thead>
        <tr><th>Name</th><th>Value</th></tr>
      </thead>
{% for key,value in run.parameters|dictsort %}
      <tr>
        <td> <b>{{key}}</b> </td>
        <td>{{value}}</td>
      </tr>
{% endfor %}
      </table>
{{ utils.render_popup_end() }}
{{ caller() }}

    </td>
  </tr>
</table>

{% endmacro %}
